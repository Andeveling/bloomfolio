---
import { Image } from "astro:assets";
import SkillBadge from "./SkillBadge.astro";
import { ExternalLink, Eye } from "@lucide/astro";
import type { CollectionEntry } from "astro:content";

interface Props {
  project: CollectionEntry<"projects">;
}

import { formatPeriod, toISODateTime } from "../utils/formats";
const { project } = Astro.props;
---

<article class="group relative bg-base-100 rounded-3xl overflow-hidden border border-base-content/5 hover:border-base-content/10 transition-all duration-500 hover:shadow-2xl hover:shadow-primary/5">
  <!-- Image with overlay -->
  <a href={`/projects/${project.id}`} class="block relative overflow-hidden aspect-video">
    <div class="absolute inset-0 bg-gradient-to-t from-base-content/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 z-10"></div>
    <Image
      src={project.data.image}
      alt={project.data.title}
      class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
      width={600}
      height={400}
    />
  </a>

  <!-- Content -->
  <div class="p-6 space-y-4">
    <!-- Title & Date -->
    <div class="space-y-2">
      <h3 class="text-2xl font-bold tracking-tight">
        <a 
          href={`/projects/${project.id}`}
          class="hover:text-primary transition-colors duration-300"
        >
          {project.data.title}
        </a>
      </h3>
      <time
        class="text-sm text-base-content/50 font-medium"
        datetime={project.data.startDate
          ? toISODateTime(project.data.startDate) +
            (project.data.endDate
              ? "/" + toISODateTime(project.data.endDate)
              : "")
          : ""}
      >
        {formatPeriod(project.data.startDate, project.data.endDate)}
      </time>
    </div>

    <!-- Description -->
    <p class="text-base-content/70 leading-relaxed line-clamp-3">
      {project.data.description}
    </p>

    <!-- Skills -->
    <div class="flex flex-wrap gap-2">
      {project.data.skills.slice(0, 4).map((skill) => <SkillBadge skill={skill} />)}
      {project.data.skills.length > 4 && (
        <span class="px-3 py-1 text-xs font-medium text-base-content/50 bg-base-content/5 rounded-full">
          +{project.data.skills.length - 4}
        </span>
      )}
    </div>

    <!-- Actions -->
    <div class="flex items-center gap-2 pt-4">
      {project.data.demoLink && (
        <a
          href={project.data.demoLink}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-base-content/70 hover:text-base-content bg-base-content/5 hover:bg-base-content/10 rounded-xl transition-all duration-300"
        >
          <ExternalLink class="size-4" />
          Demo
        </a>
      )}
      {project.data.sourceLink && (
        <a
          href={project.data.sourceLink}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-base-content/70 hover:text-base-content bg-base-content/5 hover:bg-base-content/10 rounded-xl transition-all duration-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 32 32"
            fill="currentColor"
          >
            <path d="M16,2.345c7.735,0,14,6.265,14,14-.002,6.015-3.839,11.359-9.537,13.282-.7,.14-.963-.298-.963-.665,0-.473,.018-1.978,.018-3.85,0-1.312-.437-2.152-.945-2.59,3.115-.35,6.388-1.54,6.388-6.912,0-1.54-.543-2.783-1.435-3.762,.14-.35,.63-1.785-.14-3.71,0,0-1.173-.385-3.85,1.435-1.12-.315-2.31-.472-3.5-.472s-2.38,.157-3.5,.472c-2.677-1.802-3.85-1.435-3.85-1.435-.77,1.925-.28,3.36-.14,3.71-.892,.98-1.435,2.24-1.435,3.762,0,5.355,3.255,6.563,6.37,6.913-.403,.35-.77,.963-.893,1.872-.805,.368-2.818,.963-4.077-1.155-.263-.42-1.05-1.452-2.152-1.435-1.173,.018-.472,.665,.017,.927,.595,.332,1.277,1.575,1.435,1.978,.28,.787,1.19,2.293,4.707,1.645,0,1.173,.018,2.275,.018,2.607,0,.368-.263,.787-.963,.665-5.719-1.904-9.576-7.255-9.573-13.283,0-7.735,6.265-14,14-14Z" />
          </svg>
          Source
        </a>
      )}
      <a 
        href={`/projects/${project.id}`} 
        class="ml-auto inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-base-100 bg-primary hover:bg-primary-focus rounded-xl transition-all duration-300 hover:scale-105"
      >
        <Eye class="size-4" />
        View
      </a>
    </div>
  </div>
</article>
